generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String     @id @default(uuid())
  email           String     @unique
  senha           String
  nome            String
  tipo            UserType
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  emailVerificado Boolean    @default(false)
  empresa         Empresa?
  estudante       Estudante?
  professor       Professor?

  @@map("users")
}

model Estudante {
  id                         String        @id @default(uuid())
  userId                     String        @unique
  fotoPerfil                 String?
  matricula                  String
  curso                      String
  createdAt                  DateTime      @default(now())
  updatedAt                  DateTime      @updatedAt
  faculdade                  String?
  dataNascimento             DateTime
  genero                     String
  dataFormatura              DateTime?
  periodo                    Periodo
  semestre                   Int
  telefone                   String?
  areasInteresse             String[]      @default([])
  habilidadesComportamentais String[]      @default([])
  habilidadesTecnicas        String[]      @default([])
  candidaturas               Candidatura[]
  user                       User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("estudantes")
}

model Professor {
  id             String   @id @default(uuid())
  userId         String   @unique
  fotoPerfil     String?
  areaAtuacao    String
  areasInteresse String[]
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  dataNascimento DateTime
  departamento   String
  genero         String
  lattes         String?
  titulacao      String
  telefone       String?
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  vagas          Vaga[]

  @@map("professores")
}

model Empresa {
  id           String   @id @default(uuid())
  userId       String   @unique
  nomeFantasia String   @unique
  cnpj         String   @unique
  logo         String?
  endereco     String?
  descricao    String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  ramo         String
  setor        String
  emailContato String?
  redesSociais String[]
  telefone     String?
  website      String?
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  vagas        Vaga[]

  @@map("empresas")
}

model Vaga {
  id                     String        @id @default(uuid())
  empresaId              String?
  professorId            String?
  titulo                 String
  descricao              String
  tipo                   TipoVaga
  requisitos             String[]
  prazoInscricao         DateTime
  statusVaga             StatusVaga    @default(ATIVA)
  semestreMinimo         Int?
  createdAt              DateTime      @default(now())
  updatedAt              DateTime      @updatedAt
  cursosAlvo             String[]
  numeroVagas            Int           @default(1)
  numeroVagasPreenchidas Int           @default(0)
  candidaturas           Candidatura[]
  empresa                Empresa?      @relation(fields: [empresaId], references: [id])
  professor              Professor?    @relation(fields: [professorId], references: [id])

  @@index([statusVaga, createdAt(sort: Desc)], map: "vagas_status_created_idx")
  @@index([cursosAlvo], map: "vagas_cursosAlvo_gin", type: Gin)
  @@map("vagas")
}

model Candidatura {
  id              String            @id @default(uuid())
  vagaId          String
  estudanteId     String
  dataCandidatura DateTime          @default(now())
  status          StatusCandidatura @default(PENDENTE)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  estudante       Estudante         @relation(fields: [estudanteId], references: [userId], onDelete: Cascade)
  vaga            Vaga              @relation(fields: [vagaId], references: [id], onDelete: Cascade)

  @@index([estudanteId, dataCandidatura(sort: Desc)], map: "candidaturas_estudante_data_idx")
  @@map("candidaturas")
}

enum StatusCandidatura {
  PENDENTE
  ACEITA
  RECUSADA
}

enum TipoVaga {
  ESTAGIO
  PESQUISA
  EXTENSAO
}

enum StatusVaga {
  ATIVA
  INATIVA
  ENCERRADA
}

enum UserType {
  ESTUDANTE
  PROFESSOR
  EMPRESA
}

enum Periodo {
  MATUTINO
  VESPERTINO
  NOTURNO
}
